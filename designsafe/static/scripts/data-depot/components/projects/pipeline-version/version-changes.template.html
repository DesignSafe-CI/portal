<div class="pipeline-nav">
    <a ng-class="{'btn disabled': $ctrl.ui.loading || $ctrl.ui.submitted}"
       ng-click="$ctrl.goCitation()"
    >
        <i class="fa fa-arrow-left"></i> Back
    </a>
    <button class="btn btn-small btn-add"
            ng-click="$ctrl.submitVersion()"
            ng-disabled="$ctrl.ui.loading || $ctrl.ui.submitted"
    >
        Publish New Version
    </button>
</div>
<div class="pipeline-page">
    <div class="pipeline-header">
        <h3>Explain Version Changes</h3>
        If you need help, attend <a href="/facilities/virtual-office-hours/" target="_blank">curation office hours</a>.
        <div ng-if="$ctrl.ui.loading">
            <h3 class="text-center">
                <i class="fa fa-spinner fa-spin"></i> Loading...
            </h3>
        </div>
    </div>
    <div class="pipeline-notification">
        <div class="alert alert-success" ng-if="$ctrl.ui.success">
            <i class="fa fa-check"></i>
            Your publication revision has been submitted.
            <strong>Do not attempt to update your publication again.</strong>
            Please wait until the publication has reappeared in the publications
            area before changing anything in the project. This process can take
            up to an hour or more for large datasets.
        </div>
        <div class="alert alert-warning" ng-if="$ctrl.ui.warning">
            <i class="fa fa-exclamation-triangle"></i>
            You are required to provide a revision description. This
            will be displayed in the publication.
        </div>
        <div class="alert alert-danger" ng-if="$ctrl.ui.error">
            <i class="fa fa-times"></i>
            There was an issue when attempting to submit your project
            for revision.
            <strong>Do not attempt to update your publication again.</strong> Please
            <a href="/help/new-ticket/?category=DATA_CURATION_PUBLICATION&subject=Requesting+new+version+of+existing+publication:+{{$ctrl.project.value.projectId}}"
            target="_blank">submit a ticket</a> and we will assist you with this issue.
        </div>
        <button class="btn btn-small btn-add"
            ng-click="$ctrl.returnToProject()"
            ng-if="!$ctrl.ui.loading && $ctrl.ui.submitted"
        >
            Return to Project
        </button>
    </div>
    <div ng-if="!$ctrl.ui.loading && !$ctrl.ui.submitted">
        <div class="pipeline-section">
            <label>Version Changes</label>&nbsp;<span class="label label-danger">Required</span>
            <div>
                Specify what files you are adding, removing, or replacing, and why these changes are needed. This will be displayed to those viewing your publication, so be detailed and formal in your explanation.
            </div>
            <textarea ng-model="$ctrl.revisionText"></textarea>
        </div>
    </div>
</div>